#!/bin/dash

#####
# Reagent Management Program written by H.Yokoyama
# Erase last data
# æ›¸å¼: rerase è©¦è–¬ID åå‰ ç†ç”±
#
# version 2.6.1 (2022.05.21)
#####

echo "--------------------------------------------------"
echo "\e[34m====è©¦è–¬ä½¿ç”¨è¨˜éŒ²å–ã‚Šæ¶ˆã—====\e[0m"

id=$1

if [ -L ~/.rmp-data/data/$id.rmp ] ; then
    id_path=`readlink -n ~/.rmp-data/data/$id.rmp`
    id_tmp=`basename $id_path`
    id=${id_tmp%.rmp}
fi

if [ -e ~/.rmp-data/data/$id.rmp ] ; then
    echo "è©¦è–¬ãŒã‚ã‚Šã¾ã—ãŸ(ID: $1)"
    head -n 1 ~/.rmp-data/data/$id.rmp | tr "," "\t"
    name=$2
    reason=$3

    previous_data=`tail -n1 ~/.rmp-data/data/$id.rmp`
    begin="[9m"
    end="[0m"
    erased_data="$begin""$previous_data""$end"

    sed -i -e "s?$previous_data?$erased_data?g" ~/.rmp-data/data/$id.rmp


    echo "`date "+%Y/%m/%d %H:%M:%S"`,$name,-,-,-,`echo "â†‘ã‚’å‰Šé™¤ï¼ˆç†ç”±:$3ï¼‰"`" >> ~/.rmp-data/data/$id.rmp

    echo ""
    echo ""
    echo "è¨˜è¼‰å†…å®¹â†“"
    echo ""

    label="\e[4m\e[1mæ—¥ä»˜,ä½¿ç”¨è€…å,ä½¿ç”¨å‰[g],ä½¿ç”¨å¾Œ[g],ä½¿ç”¨é‡[g],å‚™è€ƒ\e[0m \n"
    data=`tail -n3 ~/.rmp-data/data/$id.rmp`
    echo "$label$data" | column -s, -t

    echo ""
    echo ""
    echo "å®Œäº†ã—ã¾ã—ãŸ"
else
    echo "è©¦è–¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ(ID: $id)"
fi
echo "--------------------------------------------------"
